<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Perform ballot-polling Bayesian audits for ranked voting elections
    using Dirichlet-tree prior distributions. Everest et al. (2022)
    &lt;arXiv:2206.14605&gt;, &lt;arXiv:2209.03881&gt;.">
<title>Ranked Voting Election Audits with Dirichlet-Trees • elections.dtree</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Ranked Voting Election Audits with Dirichlet-Trees">
<meta property="og:description" content="Perform ballot-polling Bayesian audits for ranked voting elections
    using Dirichlet-tree prior distributions. Everest et al. (2022)
    &lt;arXiv:2206.14605&gt;, &lt;arXiv:2209.03881&gt;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">elections.dtree</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fleverest/elections.dtree/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="prefio">
<a href="https://fleverest.github.io/prefio/" class="external-link">prefio</a><a class="anchor" aria-label="anchor" href="#prefio"></a>
</h1></div>
</div>
<div class="section level1">
<h1 id="electionsdtree-audit-ranked-voting-elections-with-dirichlet-trees">
<a href="https://fleverest.github.io/elections.dtree">elections.dtree</a>: Audit ranked voting elections with Dirichlet-trees<a class="anchor" aria-label="anchor" href="#electionsdtree-audit-ranked-voting-elections-with-dirichlet-trees"></a>
</h1>
<p>Perform ballot-polling Bayesian audits for ranked voting elections using a Dirichlet-tree prior distribution.</p>
<!-- badges: start -->

<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level4">
<h4 id="cran">CRAN<a class="anchor" aria-label="anchor" href="#cran"></a>
</h4>
<p>To install the latest minor release of <code>elections.dtree</code> from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"elections.dtree"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="github">GitHub<a class="anchor" aria-label="anchor" href="#github"></a>
</h4>
<p>To install the development release of <code>elections.dtree</code> from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"fleverest/elections.dtree"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="about-the-project">About the project<a class="anchor" aria-label="anchor" href="#about-the-project"></a>
</h2>
<div class="section level4">
<h4 id="why">Why?<a class="anchor" aria-label="anchor" href="#why"></a>
</h4>
<p>Bayesian audits of elections typically employ a Dirichlet prior, conjugate to a multinomial distribution for the observed ballots. For ranked voting systems, the number of ballot types can grow factorially. In the case of instant-runoff voting (IRV), a popular type of ranked voting system, the number of possible ballot types is <code>n!</code> with <code>n</code> candidates (assuming all candidates are ranked; it is even greater if partially completed ballots are permitted).</p>
<p>The Dirichlet distribution is a simple and effective choice if the number of ballot types is small, but becomes problematic when this number gets large. As <code>n</code> grows, the prior concentration parameters (defined by <code>a0</code> in our implementation) need to be on the order of <code>1 / n!</code> to ensure the prior is not overly informative. If <code>n</code> is large enough, this may be smaller than the available precision. Also, the fact that this varies by <code>n</code> is inconvenient. A more practical alternative is given by the Dirichlet-tree distribution, which we implement in this package.</p>
<p>The Dirichlet-tree distribution consists of nested Dirichlet distributions, arranged hierarchically in a tree structure. The structure represents the preference ordering of the candidates. Branches coming out of each node correspond to choices for which candidate to select as the next preferred, and nodes represent a ranking of candidates (a complete ranking for leaf nodes, and an incomplete ranking for internal nodes). We place a Dirichlet distribution at each node, to model the conditional split of preferences at that node. The structure as a whole then defines a Dirichlet-tree distribution. Just like the Dirichlet, it is conjugate to a multinomial distribution. Also, the Dirichlet-tree is a generalisation, including a Dirichlet as a special case.</p>
<p>Using the Dirichlet-tree as a prior distribution allows it to scale efficiently to large <code>n</code>, and does not require setting the concentration parameters (<code>a0</code>) to values that depend on <code>n</code> to perform well. depend on <code>n</code> to perform well.</p>
</div>
<div class="section level4">
<h4 id="how">How?<a class="anchor" aria-label="anchor" href="#how"></a>
</h4>
<p>In this package, the tree structure is implemented such that the nodes are only initialised when they appear in the observed ballot data (i.e. when at least one of the ballots includes a preference sequence that is represented by that node). This allows the memory-complexity to be <code>O(n*m)</code>, where <code>m</code> is the number of ballots observed in the audit process.</p>
<p>Without such lazy evaluation, the memory-complexity is necessarily <code>O(n!)</code>. Hence, our implementation of the Dirichlet distribution (based on a reducible Dirichlet-tree structure) enables a larger set of candidates than would be possible using traditional methods.</p>
<p>To sample unseen ballots without loading all nodes into memory, this repository implements a recursive strategy that generates samples starting from any uninitialized point in the tree. This works well for IRV ballot structures, since the permutation-tree structure is easily navigated given a target ballot.</p>
<p>Currently, only IRV elections have been implemented, but other ranked voting systems could be supported by implementing the corresponding social choice function.</p>
<p>In order to support different tree structures or other elections which deal with high cardinality, a similar recursive strategy for sampling should be developed (and anyone designing a new tree structure should consider this carefully).</p>
</div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level4">
<h4 id="load-some-data">Load some data<a class="anchor" aria-label="anchor" href="#load-some-data"></a>
</h4>
<p>Let’s start off by downloading some data from <a href="https://www.preflib.org/" class="external-link">PrefLib</a> using <a href="https://cran.r-project.org/package=prefio" class="external-link">prefio</a>. In this example, we select the Albury 2023 dataset containing the ballots cast in Albury for the 2023 NSW Legislative Assembly Election. Other elections for the NSW Legislative Assembly can be found <a href="https://www.preflib.org/dataset/00058" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">albury</span> <span class="op">&lt;-</span> <span class="fu">prefio</span><span class="fu">::</span><span class="fu"><a href="https://fleverest.github.io/prefio/reference/read_preflib.html" class="external-link">read_preflib</a></span><span class="op">(</span><span class="st">"nswla/00058-00000187.soi"</span>, from_preflib <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">albury</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">##         preferences frequencies</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1   [CLANCY Justin]       20249</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  [ROWLAND Marcus]        6563</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  [SINCLAIR Peter]        2392</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      [DAVERN Eli]        1651</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 [FERNANDO Asanki]         685</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6   [HAMILTON Ross]         624</span></span></code></pre></div>
<p>We can see that in this election, voters could specify as few as one candidate. Since the underlying structure for <code><a href="https://fleverest.github.io/prefio/reference/preferences.html" class="external-link">prefio::preferences</a></code> is a ranking matrix, we can easily find the length of the longest ballot as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">albury</span><span class="op">$</span><span class="va">preferences</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 7</span></span></code></pre></div>
<p>In this election, the maximum ballot length was not bounded.</p>
</div>
<div class="section level4">
<h4 id="specifying-the-prior">Specifying the prior<a class="anchor" aria-label="anchor" href="#specifying-the-prior"></a>
</h4>
<p>To work with <code>dirichlet_tree</code>s in R, there are two interfaces at your disposal. The first is a standard S3 interface which all R users will be familiar with. The second is an R6 interface which can be useful when you would like to chain commands. Other than the ability to chain commands, either interface is equivalent.</p>
<p>Here, we initialise a new Dirichlet-tree for the Albury 2023 election, requiring exactly at least one preference specified per formal ballot and using a prior <code>a0</code> parameter equal to <code>1.5</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># S3 interface</span></span>
<span><span class="va">dtree</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dirtree.html">dirtree</a></span><span class="op">(</span></span>
<span>  candidates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">albury</span><span class="op">$</span><span class="va">preferences</span><span class="op">)</span>,</span>
<span>  min_depth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  a0 <span class="op">=</span> <span class="fl">1.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R6 interface (equivalent to S3)</span></span>
<span><span class="va">dtree</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/dirichlet_tree.html">dirichlet_tree</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  candidates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">albury</span><span class="op">$</span><span class="va">preferences</span><span class="op">)</span>,</span>
<span>  min_depth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  a0 <span class="op">=</span> <span class="fl">1.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtree</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Dirichlet-tree (a0=1.5, min_depth=1, max_depth=6, vd=FALSE)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Candidates: SINCLAIR Peter ROWLAND Marcus ROBERTSON Geoffrey HAMILTON Ross FERNANDO Asanki DAVERN Eli CLANCY Justin</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Observations:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] preferences frequencies</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="observing-data">Observing data<a class="anchor" aria-label="anchor" href="#observing-data"></a>
</h4>
<p>The data observed during the auditing process should be formatted as a <code><a href="https://fleverest.github.io/prefio/reference/preferences.html" class="external-link">prefio::preferences</a></code> object. Currently, our <code>albury</code> object has class <code>prefio::aggregated_preferences</code>. We will also shuffle the ballots to imitate a real auditing scenario where we sample the ballots at random. We will only use 1000 ballots for ease of computation. To convert it to the appropriate format and shuffle we can do the following:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ballots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu">prefio</span><span class="fu">::</span><span class="fu"><a href="https://fleverest.github.io/prefio/reference/preferences.html" class="external-link">as.preferences</a></span><span class="op">(</span><span class="va">albury</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">]</span></span></code></pre></div>
<p>Then to observe our first batch of say 10 ballots, we can update the model to obtain our posterior:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># S3</span></span>
<span><span class="fu"><a href="reference/update.html">update</a></span><span class="op">(</span><span class="va">dtree</span>, <span class="va">ballots</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R6</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">ballots</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R6 using chained commands</span></span>
<span><span class="va">dtree</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/dirichlet_tree.html">dirichlet_tree</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  candidates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">albury</span><span class="op">$</span><span class="va">preferences</span><span class="op">)</span>,</span>
<span>  min_depth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  a0 <span class="op">=</span> <span class="fl">1.5</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">ballots</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtree</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Dirichlet-tree (a0=1.5, min_depth=1, max_depth=6, vd=FALSE)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Candidates: SINCLAIR Peter ROWLAND Marcus ROBERTSON Geoffrey HAMILTON Ross FERNANDO Asanki DAVERN Eli CLANCY Justin</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Observations:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="do">##                               preferences frequencies</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="do">##                           [CLANCY Justin]           2</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="do">##                          [ROWLAND Marcus]           1</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  [CLANCY Justin &gt; SINCLAIR Peter &gt; R ...]           1</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  [ROWLAND Marcus &gt; FERNANDO Asanki &gt; ...]           1</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="do">##                          [SINCLAIR Peter]           1</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  [ROWLAND Marcus &gt; SINCLAIR Peter &gt;  ...]           1</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [ROWLAND Marcus &gt; DAVERN Eli &gt; FERN ...]           1</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="do">##                         [FERNANDO Asanki]           1</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  [CLANCY Justin &gt; ROWLAND Marcus &gt; S ...]           1</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="bayesian-inference-using-the-posterior-dirichlet-tree">Bayesian inference using the posterior Dirichlet-tree<a class="anchor" aria-label="anchor" href="#bayesian-inference-using-the-posterior-dirichlet-tree"></a>
</h4>
<p>To conduct Bayesian inference using the posterior we have just obtained, we can employ monte-carlo simulation to simulate the unseen ballots and determine the election outcome many times. This can be used to estimate the probability that any particular candidate goes on to win the election under the posterior distribution.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># S3</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sample_posterior.html">sample_posterior</a></span><span class="op">(</span><span class="va">dtree</span>, n_elections <span class="op">=</span> <span class="fl">1000</span>, n_ballots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ballots</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R6</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="va">dtree</span><span class="op">$</span><span class="fu">sample_posterior</span><span class="op">(</span>n_elections <span class="op">=</span> <span class="fl">1000</span>, n_ballots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ballots</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R6 using chained commands</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/dirichlet_tree.html">dirichlet_tree</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  candidates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">albury</span><span class="op">$</span><span class="va">preferences</span><span class="op">)</span>,</span>
<span>  min_depth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  a0 <span class="op">=</span> <span class="fl">1.5</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span></span>
<span>  <span class="va">ballots</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="fu">sample_posterior</span><span class="op">(</span></span>
<span>  n_elections <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_ballots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ballots</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">##      CLANCY Justin         DAVERN Eli    FERNANDO Asanki      HAMILTON Ross </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="do">##               0.40               0.01               0.02               0.00 </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ROBERTSON Geoffrey     ROWLAND Marcus     SINCLAIR Peter </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="do">##               0.02               0.48               0.07</span></span></code></pre></div>
<p>We can also take one realisation from the posterior distribution to examine it directly, rather than automatically compute the simulated election outcome and aggregate the results. To simulate the unobserved <code>N = length(ballots) - 10</code> ballots from the posterior predictive distribution we can run the following command:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># S3</span></span>
<span><span class="va">simulated</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sample_predictive.html">sample_predictive</a></span><span class="op">(</span><span class="va">dtree</span>, n_ballots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ballots</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R6</span></span>
<span><span class="va">simulated</span> <span class="op">&lt;-</span> <span class="va">dtree</span><span class="op">$</span><span class="fu">sample_predictive</span><span class="op">(</span>n_ballots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ballots</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R6 using chained commands</span></span>
<span><span class="va">simulated</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/dirichlet_tree.html">dirichlet_tree</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  candidates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">albury</span><span class="op">$</span><span class="va">preferences</span><span class="op">)</span>,</span>
<span>  min_depth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  a0 <span class="op">=</span> <span class="fl">1.5</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span></span>
<span>  <span class="va">ballots</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="fu">sample_predictive</span><span class="op">(</span>n_ballots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ballots</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simulated</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">##                        preferences frequencies</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                 [ROWLAND Marcus]         137</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                [FERNANDO Asanki]          41</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                 [SINCLAIR Peter]          32</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 [ROWLAND Marcus &gt; HAMILTON Ross]          30</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5  [CLANCY Justin &gt; HAMILTON Ross]          29</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6                  [CLANCY Justin]          28</span></span></code></pre></div>
<p>Then we can compute the (IRV) election outcome for this simulation (plus the observed data) explicitly like this:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/social_choice.html">social_choice</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="va">ballots</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>    <span class="fu">prefio</span><span class="fu">::</span><span class="fu"><a href="https://fleverest.github.io/prefio/reference/preferences.html" class="external-link">as.preferences</a></span><span class="op">(</span><span class="va">simulated</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  sc_function <span class="op">=</span> <span class="st">"irv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## $elimination_order</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "DAVERN Eli"         "HAMILTON Ross"      "ROBERTSON Geoffrey"</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [4] "SINCLAIR Peter"     "FERNANDO Asanki"    "CLANCY Justin"     </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $winners</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "ROWLAND Marcus"</span></span></code></pre></div>
<p>Finally, we can reset the model to the original prior distribution:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># S3</span></span>
<span><span class="fu"><a href="reference/reset.html">reset</a></span><span class="op">(</span><span class="va">dtree</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R6</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtree</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Dirichlet-tree (a0=1.5, min_depth=1, max_depth=6, vd=FALSE)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Candidates: SINCLAIR Peter ROWLAND Marcus ROBERTSON Geoffrey HAMILTON Ross FERNANDO Asanki DAVERN Eli CLANCY Justin</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Observations:</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] preferences frequencies</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre></div>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=elections.dtree" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/fleverest/elections.dtree/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/fleverest/elections.dtree/issues/" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing elections.dtree</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Floyd Everest <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-2726-6736" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Damjan Vukcevic <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-7780-9586" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=elections.dtree" class="external-link"><img src="https://www.r-pkg.org/badges/version/elections.dtree" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://fleverest.github.io/elections.dtree/"><img src="https://github.com/fleverest/elections.dtree/workflows/pkgdown/badge.svg" alt="pkgdown"></a></li>
<li><a href="https://github.com/fleverest/elections.dtree/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/fleverest/elections.dtree/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/fleverest/elections.dtree?branch=main" class="external-link"><img src="https://codecov.io/gh/fleverest/elections.dtree/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Floyd Everest, Damjan Vukcevic.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
